### Origin of the technique
The Component Object Model (COM) enables inter-process communication object creation. When the attackers COM is loaded instead of the intended COM, this is called a COM hijack.

### How to achieve persistence
There are multiple approaches to COM hijack, including:
- By CLSID - create a new entry under `HKEY_CURRENT_USER\Software\Classes\CLSID` matching the CLSID a program is looking for. Since the search order (for non-elevated processes) is to first look in the HKCU registry, this can hijack the COM object.
- By ProgID - some processes use the ProgID to find a COM object instead of the CLSID. The CLSID is then stored in`HKEY_CURRENT_USER\Software\Classes\<ProgID>\CLSID`
- By TreatAs - can redirect to another COM.

The location of the exe or DLL is stored in `LocalServer32` or `InprocServer32` respectively, under `HKEY_CURRENT_USER\Software\Classes\CLSID\{GUUID}`

### Requirements
User privileges for non-elevated COM objects, otherwise higher privileges.

### The achieved persistence
Runs when the COM object is loaded by another program. Non-destructive because you can use a COMProxy (e.g. https://github.com/leoloobeek/COMProxy). Can run both exe (in `LocalServer32`) or DLL (in `InprocServer32`).



### More information
- https://cocomelonc.github.io/tutorial/2022/05/02/malware-pers-3.html
- https://www.mdsec.co.uk/2019/05/persistence-the-continued-or-prolonged-existence-of-something-part-2-com-hijacking/
- https://attack.mitre.org/techniques/T1546/015/
- https://stmxcsr.com/persistence/com-hijacking.html
- https://github.com/SigmaHQ/sigma/blob/16990093933fe8c82c3ad879d306d706b350162a/rules/windows/registry/registry_set/registry_set_persistence_search_order.yml