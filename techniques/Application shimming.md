### Origin of the technique
Application shims are used to ensure backward compatibility of programs with the operating system.

### How to achieve persistence
Under `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom\`, create a key for the targeted application, e.g. `firefox.exe`.  Under that, create a value `{<GUID>}.sdb` of type `QWORD`.
Next, create the key `{<GUID>}` under `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB\`. Set the value of `DatabasePath` to the location of the shimming database file (`.sdb`). Also set the `DatabaseRuntimePlatform` value to a `DWORD` matching the type of shimming you want to use. Lastly, set `DatabaseType` to the type of database you are using.

Another option is making changes to existing `sdb` files.

### Requirements
Administrator privileges to write to the registry.

### The achieved persistence
How exactly the persistence works differs per type of shimming, but in general the code is executed when the targeted application is ran.

### More information
- https://attack.mitre.org/techniques/T1546/011/
- https://www.ired.team/offensive-security/persistence/t1138-application-shimming
- https://github.com/SigmaHQ/sigma/blob/33b370d49bd6aed85bd23827aa16a50bd06d691a/rules/windows/registry/registry_set/registry_set_shim_databases_persistence.yml
- https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html