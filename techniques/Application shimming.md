### Origin of the technique
Application shims are used to ensure backward compatibility of programs with the operating system.

### How to achieve persistence
The easiest approach is to use the `sdbinst.exe` utility. E.g. `sdbinst.exe file.sdb`

Alternatively, you can write directly to the registry.
Under `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom\`, create a key for the targeted application, e.g. `firefox.exe`.  Under that, create a value `{<GUID>}.sdb` of type `QWORD`. Normally, the value of this value is set to the install time.
Next, create the key `{<GUID>}` under `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB\`. Set the value of `DatabasePath` to the location of the shimming database file (`.sdb`). Also set the `DatabaseRuntimePlatform` value to a `DWORD` matching the type of shimming you want to use. Lastly, set `DatabaseType` to the type of database you are using.

Another option is making changes to existing `sdb` files.

### Requirements
Administrator privileges are required. Requires at least a write to a `sdb` file. 

### The achieved persistence
How exactly the persistence works differs per type of shimming. In general the code is injected and executed when the targeted application is ran.

### More information
- https://attack.mitre.org/techniques/T1546/011/
- https://www.ired.team/offensive-security/persistence/t1138-application-shimming
- https://github.com/SigmaHQ/sigma/blob/33b370d49bd6aed85bd23827aa16a50bd06d691a/rules/windows/registry/registry_set/registry_set_shim_databases_persistence.yml
- https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html
- https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/deployment/compatibility/using-the-sdbinstexe-command-line-tool