y### Origin of the technique
WMI  stands for Windows Management Instrumentation. You can create a EventFilter which queries for a specific event. When this even occurs, a specific action can be executed. The consumer can be CommandLineEventConsumer, which allows for command execution.

### How to achieve persistence
WMI events subsriptions are stored in the WMI repository, which can be found in `%windir%\System32\Wbem\Repository` (`OBJECTS.DATA` file). You could write to it, but the format is not very straight forward, and the file is opened by another process.

Normally, you interact with WMI as a COM object. To initialize, you always refer to IWbemLocator (`4590F811-1D3A-11D0-891F-00AA004B2E24`)

### Requirements
You need to have admin privileges. You need to write to the directory mentioned above. However, it is a not-so-easy to understand database, so it is virtually impossible to write to it apart from using the provided WMI API. 

### The achieved persistence
You can connect execution of any command to many events. The command will run as system.


### More information
- https://www.mdsec.co.uk/2019/05/persistence-the-continued-or-prolonged-existence-of-something-part-3-wmi-event-subscription/
- http://www.fuzzysecurity.com/tutorials/19.html
- https://wumb0.in/scheduling-callbacks-with-wmi-in-cpp.html
- https://attack.mitre.org/techniques/T1546/003/
- https://stmxcsr.com/persistence/wmi-persistence.html
- https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/
- https://www.blackhat.com/docs/us-15/materials/us-15-Graeber-Abusing-Windows-Management-Instrumentation-WMI-To-Build-A-Persistent%20Asynchronous-And-Fileless-Backdoor-wp.pdf