### Origin of the technique
This technique is based on the Windows Antimalware Scan InterfaceÂ (AMSI). AMSI is used to evaluate whether a script is malicious. Any program running can request AMSI to scan a script, for example PowerShell does this before running anything. Anti-malware solutions can register as a provider. For this technique the malware registers itself as an AMSI provider.

### How to achieve persistence
First, you need to register the COM server by adding a new CLSID in `HKLM\SOFTWARE\Classes\CLSID`. See [[COM hijack]].
This can also be done using `Regsvr32.exe FakeAMSI.dll`. 

Next, register the COM server as an AMSI provider by adding the CLSID as a key to `HKLM\SOFTWARE\Microsoft\AMSI\Providers`. 

### Requirements
Administrator privileges to create the COM server.

### The achieved persistence
Runs with user privileges. Runs when the AMSI operates. E.g. when opening Powershell.


### More information
- https://persistence-info.github.io/Data/amsi.html
- https://learn.microsoft.com/en-us/windows/win32/amsi/dev-audience
- https://github.com/gtworek/PSBits/blob/master/FakeAMSI/FakeAMSI.c