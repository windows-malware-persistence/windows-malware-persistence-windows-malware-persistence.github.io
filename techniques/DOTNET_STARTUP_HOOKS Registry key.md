# DOTNET_STARTUP_HOOKS Registry key

### Origin of the technique
.NET core applications load a DLL at the start if the `DOTNET_STARTUP_HOOKS` environment variable is set.

### How to achieve persistence
Write the location of the malicious DLL to the Environment `DOTNET_STARTUP_HOOKS` registry key. 
You can store environment variables in the registry under `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment`
or `HKEY_CURRENT_USER\Environment`.

### Requirements
User privileges if you want to set only for the current user.
The format of the DLL is special, and has to be written in C#. 

### The achieved persistence
Some .NET core application has to launch. 


## Quick steps
DLL.cs source:
```c#
using System;
using System.IO;

internal class StartupHook
{
    public static void Initialize()
    {
       Console.WriteLine("Hello world!");
       string fileName = "C:\\Users\\IEUser\\Desktop\\succes.txt";
       if (File.Exists(fileName))    
       {    
              File.Delete(fileName);    
       }
       File.Create(fileName);
    
    }
}
```

Then set the env variable, and run for example `dotnet.exe -h`.


### More information
- https://persistence-info.github.io/Data/dotnetstartuphooks.html
- https://github.com/dotnet/runtime/blob/main/docs/design/features/host-startup-hook.md