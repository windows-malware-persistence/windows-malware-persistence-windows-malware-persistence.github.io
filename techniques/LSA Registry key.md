# LSA Registry key
### Origin of the technique
LSA (Local Security Authority extension) authentication packages are used when the user authenticates itself. It loads DLLs that are specified in the registry, which can be leveraged.
There are various flavours of this technique. Each teargets a different DLL and works a bit differently.

### How to achieve persistence
#### Authentication packages
`HKLM\SYSTEM\CurrentControlSet\Control\Lsa\` with the key value of `"Authentication Packages"=<target dll>`. The DLL should be placed in System32.
#### Extension
Add your own DLL to the list in `HKLM\SYSTEM\CurrentControlSet\Control\LsaExtensionConfig\LsaSrv`, key `Extensions`. Place your DLL ins `C:\Windows\System32`

#### Notification packages
Write to the key `Notification packages` in `HKLM\SYSTEM\CurrentControlSet\Control\Lsa`. Write your DLL to System32.

#### Security packages
Write DLL name to `HKLM\SYSTEM\CurrentControlSet\Control\Lsa\`, key `Security Packages` 
or
`HKLM\SYSTEM\CurrentControlSet\Control\Lsa\OSConfig\`, key `Security Packages`
and place the DLL in system32

### Requirements
The LSA Extension tehchnique requires Truster Installer privileges. The other variants require admin privileges

### The achieved persistence
When the user authenticates himself.

### More information
- https://persistence-info.github.io/Data/authenticationpackages.html
- https://attack.mitre.org/techniques/T1547/002/
- https://persistence-info.github.io/Data/lsaaextension.html
- https://persistence-info.github.io/Data/passwordfilter.html
- https://attack.mitre.org/techniques/T1547/005/