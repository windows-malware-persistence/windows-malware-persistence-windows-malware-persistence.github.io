### Origin of the technique
Active Setup is a mechanism used to set up configuration when a new user logs in for the first time after new software has been installed. To know when to perform this action Active Setup checks if each machine part component GUID is present in the user part of the registry. If one is missing, Active Setup runs the commands associated with the missing GUID.

### How to achieve persistence
By adding a new GUID to the Registry under `HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components`, it is possible to run a command at login. The command should be stored in  `StubPath`.

### Requirements
Writing to the HKLM registry requires administrator privileges. Also, not all systems execute Active Setup by default on login. In that case, to trigger execution, it can be combined with another persistence technique. This other technique should then execute `%systemroot%\system32\runonce.exe /AlternateShellStartup`.

### The achieved persistence
This persistence technique executes the specified command when the user logs in, before the desktop appears. The desktop does not show before the command is finished. To achieve persistence after another reboot, removing the key in the user registry `HKCU\SOFTWARE\Microsoft\Active Setup\Installed Components` suffices.

### More information
- https://attack.mitre.org/techniques/T1547/014/
- https://helgeklein.com/blog/active-setup-explained/