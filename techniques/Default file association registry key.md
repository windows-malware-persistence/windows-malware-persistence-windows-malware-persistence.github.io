
### Origin of the technique
This technique changes the executable that files are opened with. For example, you can specify to open files ending with `.txt` with a custom application.

### How to achieve persistence
Change the registry key `HKEY_CLASSES_ROOT\<extension>file\shell\open\command`
Also related, but for when printing file:
-   `HKEY_CLASSES_ROOT\txtfile\shell\print\command`
-   `HKEY_CLASSES_ROOT\txtfile\shell\printto\command`

### Requirements
Admin privileges to write to the registry.

### The achieved persistence
When you open a file with the file extension targeted, it will run your executable (with the specified arguments) instead. The privileges depend on if the user opens the file as administrator or not.

### More information
- https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/troj_fakeav.gzd
- https://attack.mitre.org/techniques/T1546/001/
- http://woshub.com/managing-default-file-associations-in-windows-10/

Combine with [[Startup folder]] for start on boot and not breaking functionality. (https://news.sophos.com/en-us/2022/02/01/solarmarker-campaign-used-novel-registry-changes-to-establish-persistence/)