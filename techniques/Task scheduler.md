# Task scheduler
### Origin of the technique
The Windows operating system has a feature that let;s you schedule tasks. We can use this to schedule the execution of arbitrary commands.

### How to achieve persistence

You can use the schtasks utility to schedule tasks from cmd: https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks

Scheduled taks tasks are stored in the registry. 
- `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tasks\<name>`
- `HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Plain\{GUID}`

Note that some task information is also stored in `C:\Windows\System32\Tasks`, but making changes to these file does not have any effect on execution.


### Requirements
To write to the tasks registry, you need to be System. I.e., administrator is not enough. However, when not writing directly to the registry but instead using the task scheduler, user privileges are enough.

### The achieved persistence
A task can be scheduled to be executed at boot, at log in, every time frame and more. The privileges can be set to system. 


### More information
- https://labs.withsecure.com/publications/scheduled-task-tampering
- https://docs.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-start-page
- https://persistence-info.github.io/Data/taskscheduler.html
- https://www.fuzzysecurity.com/tutorials/19.html
- https://stmxcsr.com/persistence/scheduled-tasks.html
- https://attack.mitre.org/techniques/T1053/005/
